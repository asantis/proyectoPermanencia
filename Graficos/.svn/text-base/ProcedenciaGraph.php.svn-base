<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<style type="text/css">
${demo.css}
		</style>
		<script type="text/javascript">
$(function () {
    $('#container').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false
        },
        title: {
            text: 'Ingresos segun Procedencias  '
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.y:,.0f}'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Cantidad',
            data: [
			
<?php
$mysqli = new mysqli("localhost","root","","proyecto");

$exit = "";

$sql = "select p.Procedencia as 'Procedencia_nombre' , count(i.Procedencia) as 'cant_procedencia' from ingresos i 
join procedencias p on p.idProcedencia=i.Procedencia
group by p.Procedencia
";
		
if(isset($_POST['date'])){
$x = $mysqli ->real_escape_string($_POST['date']);	
$sql =  "SELECT p.Procedencia as 'Procedencia_nombre' , COUNT(i.Procedencia) as 'cant_procedencia' FROM ingresos i 
join procedencias p on p.idProcedencia=i.Procedencia
WHERE i.fecha = '" .$x. "'
GROUP BY  p.Procedencia
";
}

$result = $mysqli->query($sql);
if ($result->num_rows > 0 ){
	
	while($row =$result->fetch_assoc()){
	?>
	['<?php echo $row['Procedencia_nombre'];?>',   <?php echo $row['cant_procedencia'] ?>],<?php 
}
	}
	
	echo($exit);
	$mysqli->close();
?>


            ]
        }]
    });
});

</script>








<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Grafico de Procedencias</title>
<script src="../js/jquery.min.js"></script>
<script src="../js/fechas.js"></script>

<style>
.Formulario {
margin-left: 4%;
max-width: 400px;
height: 300px;
width: 300px;	

}
</style>
</head>

<body>


    <br>
    <br><br>
<script src="../Highcharts-4.1.5/js/highcharts.js"></script>
<script src="../Highcharts-4.1.5/js/modules/exporting.js"></script>

<div class="Formulario">
<form method="POST" action="#"> 

<a style="font-size:20px; font-weight:bold; margin-left:5%">Seleccione una fecha para filtrar </a>
<br />
<br />
<br />
<input style="margin-left:15%; width:200px; font-size:17px; text-align:justify" type="date" name="date" id="date"/>
<br />
<br />
<?php 

	if($_POST){
		?>
<a style="font-size:20px; margin-left:5%"> Fecha Seleccionada:  </a><a style="font-size:18px">
<?php
	echo $_POST['date'];
	}
?> </a>
<br />
<br />
<input style="font-size:17px; width:150px; height:30px; margin-left: 20%;" type="submit" name="envio" id="envio" />
<br /> <br />
<a href="ProcedenciaGraph.php"><input style="font-size:17px; width:150px; height:30px; margin-left: 20%" type="button" value="Reiniciar" /> </a> 
</form>

</div>

<div id="container" style="height: 500px; max-width: 60%;  margin-left:30%; margin-top:-300px; width:80% "></div>
<?php $ua = strtolower($_SERVER['HTTP_USER_AGENT']);
if(stripos($ua,'android') !== false or stripos($ua,'IPHONE') !== false){ ?>
<center><a href="../Registros/RegistroGraficos.php"> Volver Atras </a></center>
<?php }else{ ?><center><a href="../informes.php"> Volver Atras </a></center><?php } ?>


</body>
</html>